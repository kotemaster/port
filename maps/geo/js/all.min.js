if(typeof APP=="undefined")var APP=angular.module("WS",[]);APP.factory("TPL",[function(){return{footerWs:'\n<div id="footer" ng-init="addr=\'163 Legionow Gdyna Poland\'">\n    <div id="panel">\n      <input id="address" type="textbox" ng-model="addr">\n      <input type="button" value="Locate on Map" ng-click="locAddress()">\n    </div>\n    <div ng-show="coords.lon">Lon: {{coords.lon}}, Lat: {{coords.lat}}</div>\n    <div ng-show="coords.elevation" class="elevation">Elevation(m): {{coords.elevation}}</div>\n    <div class="notify">{{message}}</div>\n</div>\n',leftWs:'\n<div id="left">\n    <div ng-show="channels">\n        <div class=\'buttonWrap\'>\n            <div>Channels:</div>\n            <button ng-repeat="channel in channels" ng-click="chanSel(channel[0])"\n                ng-class="vis[channel[0]]|threeWay"\n            >{{channel[0]}}</button>\n        </div>\n        <div class="buttonWrap wide">\n            <button ng-click="show()">Show/Hide All</button>\n            <button ng-click="toFront()" ng-class="inFront|checkActive">To Front</button>\n        </div>\n        <div class="buttonWrap">\n            <button ng-click="rng[0]=!rng[0]; range(0)" class="long" ng-class="rng[0]|checkActive">Long</button>\n            <button ng-click="rng[1]=!rng[1]; range(1)" class="med" ng-class="rng[1]|checkActive">Med</button>\n            <button ng-click="rng[2]=!rng[2]; range(2)" class="short" ng-class="rng[2]|checkActive">Short</button>\n        </div>\n        <div class=\'buttonWrap\' ng-show="selChan">\n            <ul>\n                <li>Chan: {{selChan.Channel}}</li>\n                <li>BWkHz: {{selChan.BWkHz}}</li>\n                <li>Band: {{selChan.Band}}</li>\n                <li>Freq: {{selChan.FreqMHz}}</li>\n            </ul>\n            <button ng-click="toDev(dev.loc[2])" ng-repeat="dev in chanDevs">{{dev.loc[2]}}</button>\n        </div>\n    </div>\n</div>\n',mapWs:'\n<div id="content"></div>\n',menuWs:'\n<div id="contentMenu" ng-class="active|checkActive">\n    <button ng-click="activate(\'box\');" ng-class="box|checkActive">Box</button>\n    <button ng-click="activate(\'point\');" ng-class="point|checkActive">Point</button>\n    <button ng-click="activate(\'center\');" ng-class="center|checkActive">Center</button>\n    <button ng-click="activate(\'elevation\');" ng-class="elevation|checkActive">Elevation</button>\n    <div id="options">\n        <span>Options</span>\n        <div><label for="devCenter">Center On Device Click</label><input id="devCenter" type="checkbox" ng-model="devCenter"></input></div>\n        <div><label for="autoOff">Menu Auto Off</label><input id="autoOff" type="checkbox" ng-model="autoOff"></input></div>\n    </div>\n</div>\n',rightWs:'\n<div id="right">\n    <div ng-show="devices">\n        <div class=\'buttonWrap\' ng-show="devices">\n            <div>Devices:</div>\n            <button ng-repeat="device in devices" ng-click="devSel(device._ID[2])"\n                ng-class="vis[device._ID[2]]|threeWay"\n            >{{device._ID[2]}}</button>\n        </div>\n        <div class="buttonWrap wide">\n            <button ng-click="show()">Show/Hide All</button>\n            <button ng-click="toFront()" ng-class="inFront|checkActive">To Front</button>\n        </div>\n        <div class="buttonWrap" ng-show="selDevice.Chans">\n            Device Channels:\n            <button ng-repeat="chan in selDevice.Chans">{{chan.Chan}}</button>\n        </div>\n        <div class="buttonWrap" ng-show="selDevice.Chans">\n            Device Parameters:\n            <ul>\n                <li>Id: {{selDevice.Id}}</li>\n                <li>Agl: {{selDevice.Agl}}</li>\n                <li>Address: {{selDevice.Address}}</li>\n                <li>City: {{selDevice.City}}</li>\n            </ul>\n        </div>\n    </div>\n</div>\n',whitespace:'\n<div id="container">\n    <div left-ws></div>\n    <div menu-ws></div>\n    <div map-ws></div>\n    <div right-ws devices="devices" dev-center="devCenter" to-dev-id="toDevId"></div>\n    <div footer-ws></div>\n</div>\n'}}]);if(typeof APP=="undefined")var APP=angular.module("WS",[]);window.whitespacePluginLoaded=false;APP.controller("loader",["$scope","$element","$compile",function($scope,$element,$compile){$scope.loadWS=function(){var s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("src","./js/directive.js");document.getElementsByTagName("head")[0].appendChild(s);console.log($element);console.log($element.find("plugin"));setTimeout(function(){console.log(window.whitespacePluginLoaded,"ws loaded");$element.find("plugin").append($compile(angular.element("<whitespace>whitespace plug</whitespace>"))($scope))},1500)}}]);APP.factory("DATA",["$http",function($http){var urlHref=document.location.href;var urlBase=urlHref+(document.location.host=="geo"?"/noMVC/":"/Api/");var Stor={Dev:{list:[],idx:{},chan:{}},Chan:{list:[],idx:{},dev:{}}};var qString=function(url,pt1,pt2,opt1,opt2){ret="";switch(url){case"WsTvwsLookup":ret="?k=a&lo="+pt1.lon+"&la="+pt1.lat;break;case"WsChannelsList":ret="?k=a";break;case"WsDeviceDetails":ret="?k=a&ids=1,2,3";break;case"WsDeviceList":ret="?k=a&lonMin="+pt1.lon+"&latMin="+pt1.lat+"&lonMax="+pt2.lon+"&latMax="+pt2.lat;break}return ret};var Chan={WsTvwsLookup:{set:function(data){if(data.length){Stor.Chan.list=[];Stor.Chan.idx={}}for(var i=0;i<data.length;i++)Stor.Chan.list.push(Stor.Chan.idx[data[i].Channel]=[data[i].Channel,data[i].Value])}},WsChannelsList:{set:function(data){for(var i=0;i<data.length;i++)Stor.Chan.idx[data[i].Channel]=data[i]}}};var Dev={WsDeviceList:{set:function(data){if(data.length){Stor.Dev.list=[];Stor.Dev.idx={}}for(var i=0;i<data.length;i++){Stor.Dev.list.push(Stor.Dev.idx[data[i].Id]={_ID:[data[i].Long4Dec,data[i].Lat4Dec,data[i].Id]})}}},WsDeviceDetails:{set:function(data){if(data.length){Stor.Chan.dev={};Stor.Dev.chan={}}for(var i=0;i<data.length;i++)if(typeof Stor.Dev.idx[data[i].Id]!="undefined"){data[i]._ID=Stor.Dev.idx[data[i].Id]._ID;Stor.Dev.idx[data[i].Id]=data[i];if(typeof Stor.Dev.chan[data[i].Id]=="undefined")Stor.Dev.chan[data[i].Id]=[data[i].Chans];else Stor.Dev.chan[data[i].Id].push(data[i].Chans);for(var j=0;j<Stor.Dev.chan[data[i].Id].length;j++)for(var k=0;k<Stor.Dev.chan[data[i].Id][j].length;k++){var chan=Stor.Dev.chan[data[i].Id][j][k];if(typeof Stor.Chan.dev[chan.Chan]=="undefined")Stor.Chan.dev[chan.Chan]=[{Pwr:chan.Pwr,loc:data[i]._ID}];else Stor.Chan.dev[chan.Chan].push({Pwr:chan.Pwr,loc:data[i]._ID})}}}}};var set=function(url,data,cb){switch(url){case"WsTvwsLookup":case"WsChannelsList":Chan[url].set(data);break;case"WsDeviceDetails":case"WsDeviceList":Dev[url].set(data);break}var typ=url.indexOf("Device")<0?"Chan":"Dev";typeof cb=="function"&&cb(Stor[typ].list)};var get=function(url,cb,pt1,pt2,opt1,opt2){var fullUrl=urlBase+url+qString(url,pt1,pt2,opt1,opt2);$http.get(fullUrl).success(function(data){set(url,data,cb)})};return{url:urlHref,get:get,chanLoc:function(id){return Stor.Chan.dev[id]},findChan:function(id){return Stor.Chan.idx[id]},findDev:function(id){return Stor.Dev.idx[id]},devChans:function(){return Stor.Chan.dev},chanDevs:function(){return Stor.Dev.chan},chanIdx:function(){return Stor.Chan.idx},devIdx:function(){return Stor.Dev.idx}}}]);APP.directive("mapWs",["TPL","GEO",function(TPL,GEO){return{restrict:"A",replace:true,template:TPL.mapWs,link:function(scope,el){setTimeout(function(){GEO.init(el[0])},0)}}}]).directive("leftWs",["TPL","GEO","DATA",function(TPL,GEO,DATA){return{restrict:"A",replace:true,template:TPL.leftWs,scope:true,link:function($scope,el){var active=0;var hideAll=false;$scope.vis=false;$scope.rng=[true,true,true];$scope.$on("devLoad",function(){LG("chan loaded");GEO.initChans();$scope.vis={};for(var i in DATA.chanIdx())$scope.vis[i]=0});var setVis=function(chanId){if($scope.vis){if(active!=chanId)$scope.vis[active]==2&&($scope.vis[active]=1);$scope.vis[chanId]=$scope.vis[chanId]?0:2;active=chanId}};$scope.chanSel=function(chanId){setVis(chanId);$scope.selChan=$scope.vis[chanId]?DATA.findChan(chanId):false;$scope.chanDevs=DATA.chanLoc(chanId);if(typeof $scope.chanDevs=="undefined")$scope.notify("No devices loaded for channel Id: "+chanId);else GEO.chanVis(chanId,$scope.chanDevs,$scope.vis[chanId])};$scope.range=function(idx){GEO.range(idx,$scope.rng[idx])};$scope.toFront=function(){GEO.chanToFront()};$scope.show=function(){for(var i in $scope.vis)$scope.vis[i]=hideAll?0:1;GEO.showChan(hideAll=!hideAll)}}}}]).directive("rightWs",["TPL","GEO","DATA",function(TPL,GEO,DATA){return{restrict:"A",replace:true,template:TPL.rightWs,scope:{devices:"=",devCenter:"=",toDevId:"="},link:function($scope,el){var active=0;var hideAll=false;$scope.vis={};$scope.$watch("toDevId",function(n,o){if(typeof n!="undefined"){$scope.devSel(n);$scope.vis[n]<1&&$scope.devSel(n)}});$scope.$on("devLoad",function(){GEO.initDevs();$scope.vis={};for(var i in DATA.devIdx())$scope.vis[i]=0});$scope.devSel=function(devId){$scope.selDevice=DATA.findDev(devId);typeof $scope.vis[devId]=="undefined"&&($scope.vis[devId]=0);typeof active!="undefined"&&$scope.vis[active]&&($scope.vis[active]=1);$scope.vis[devId]=$scope.vis[devId]?0:2;GEO.deviceVis(DATA.findDev(devId)._ID[2],$scope.vis[devId],active,$scope.devCenter);active=devId};$scope.show=function(){for(var i in $scope.vis)$scope.vis[i]=hideAll?0:1;GEO.showDev(hideAll=!hideAll)};$scope.toFront=function(){$scope.devTop=1;GEO.devToFront()}}}}]).directive("menuWs",["TPL","OLCtrl","DATA",function(TPL,OLCtrl,DATA){return{restrict:"A",replace:true,template:TPL.menuWs,link:function($scope,el){$scope.active="";$scope.autoOff=true;$scope.devCenter=false;$scope.point=$scope.center=$scope.elevation=$scope.box=0;var setActive=function(ctrlName){if($scope.autoOff){OLCtrl.deactivate($scope.active);$scope[ctrlName]=0;$scope.active=""}$scope.$digest()};var ctrls={box:function(tL,bR){$scope.coords.lon=tL.lon.toFixed(2)+"/"+bR.lon.toFixed(2);$scope.coords.lat=tL.lat.toFixed(2)+"/"+bR.lat.toFixed(2);setActive("box");DATA.get("WsDeviceList",function(data){$scope.devices=data;DATA.get("WsDeviceDetails",function(data){$scope.notify("Loaded "+data.length+" devices");$scope.$broadcast("devLoad")})},tL,bR)},point:function(loc,el){$scope.coords.lon=loc.lon.toFixed(4);$scope.coords.lat=loc.lat.toFixed(4);setActive("point");DATA.get("WsTvwsLookup",function(data){$scope.channels=data;DATA.get("WsChannelsList",function(data){})},loc)},center:function(loc,el){$scope.coords.lon=loc.lon.toFixed(4);$scope.coords.lat=loc.lat.toFixed(4);setActive("center")},elevation:function(loc,el){$scope.coords.elevation=el.toFixed(4);$scope.coords.lon=loc.lon.toFixed(4);$scope.coords.lat=loc.lat.toFixed(4);setActive("elevation")}};$scope.activate=function(ctrlName){OLCtrl.deactivate($scope.active?$scope.active:"elevation");if(ctrlName!=$scope.active){$scope.active&&($scope[$scope.active]=0);$scope.active=ctrlName;$scope[ctrlName]=1;OLCtrl.activate(ctrlName,ctrls[ctrlName])}else{$scope[$scope.active]=0;$scope.active=""}};setTimeout(function(){$scope.activate("box");ctrls.box({lat:16.5,lon:53.959},{lat:27.3,lon:65.959});ctrls.point({lat:20.5,lon:53.959});$scope.activate("center");$scope.$digest()},200)}}}]).directive("footerWs",["TPL",function(TPL){return{restrict:"A",replace:true,template:TPL.footerWs,link:function($scope,el){}}}]).directive("whitespace",["TPL","GEO",function(TPL,GEO){return{restrict:"E",replace:false,scope:{plugData:"="},template:TPL.whitespace,link:function($scope,$element,$attributes){$scope.message="";$scope.channels=false;$scope.devTop=1;$scope.notify=function(msg,status,duration){$scope.message=msg};$scope.coords={};$scope.locAddress=function(){GEO.locAddress($scope.addr,function(coords){$scope.coords=coords;$scope.$digest()})};$scope.toDev=function(devId){$scope.toDevId=devId}}}}]);window.whitespacePluginLoaded=true;APP.filter("alterRow",function(){return function(input,arg,skip){input-=arg-1;if(typeof skip=="undefined")skip=2;return Math.floor(input/skip-.001)%2?"":"alter"}}).filter("checkActive",function(){return function(input){return input?"active":""}}).filter("checkInactive",function(){return function(input){return input?"inactive":""}}).filter("pushBack",function(){return function(input){return input?"inactive":""}}).filter("threeWay",function(){return function(input){var ret;switch(input){case 1:ret="down";break;case 2:ret="up";break;default:ret="noshow";break}return ret}});function LG(arg){console.log(arguments)}if(typeof APP=="undefined")var APP=angular.module("WS",[]);APP.factory("GEO",["DATA","OLCtrl","OLC",function(DATA,OLCtrl,OLC){var zoom=8;var zIndex=10;var map;var devActive=false;var devMarkers={};var chanContours={};var devUrl=["",DATA.url+"image/markgreen.png",DATA.url+"image/markred.png"];var geocoder;var _this=this;function lonLat(lon,lat,trans){return trans?new OpenLayers.LonLat(lon,lat).transform("EPSG:4326","EPSG:3857"):new OpenLayers.LonLat(lon,lat)}var contours=["contL","contM","contS"];function getRange(pwr,byPwr){var l=byPwr?pwr>=-7?"L":pwr<-13?"S":"M":pwr?pwr>1?"S":"M":"L";return"cont"+l}function toTop(layers,noVis){typeof layers=="string"&&(layers=[layers]);for(var i=0;i<layers.length;i++){map.setLayerIndex(_this[layers[i]],zIndex++);typeof noVis!="undefined"&&noVis||_this[layers[i]].setVisibility(true);_this[layers[i]].redraw()}}function clearDevMarkers(){_this.deviceL.clearMarkers();for(var i in devMarkers){devMarkers[i].destroy();delete devMarkers[i]}devMarkers={}}return{map:map,init:function(domEl){var bingK="AgAuqEizNCG46goQiquz3ERCSuMYj8hr1udAEXpb1-kix08_29KzSOGQCkyL_eJc";geocoder=new google.maps.Geocoder;map=new OpenLayers.Map("content",{layers:[new OpenLayers.Layer.Google("Google Streets",{numZoomLevels:22}),new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,numZoomLevels:18}),new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20}),new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:22}),new OpenLayers.Layer.Bing({name:"Bing Road",key:bingK,type:"Road"}),new OpenLayers.Layer.Bing({name:"Bing Hybrid",key:bingK,type:"AerialWithLabels"}),new OpenLayers.Layer.Bing({name:"Bing Aerial",key:bingK,type:"Aerial"})],center:lonLat(58.043,23.523,true),zoom:zoom,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.LayerSwitcher({ascending:true}),new OpenLayers.Control.ScaleLine]});OLCtrl.setMap(map);OLCtrl.init(["box","point","center","elevation"]);map.addLayers([_this.centerL=OLC.Markers("centerL"),_this.deviceL=OLC.Markers("deviceL"),_this.contL=OLC.Contours("contL"),_this.contM=OLC.Contours("contM"),_this.contS=OLC.Contours("contS")])},initDevs:function(){var data=DATA.devIdx();clearDevMarkers();for(var i in data){if(typeof devMarkers[data[i]._ID[2]]=="undefined")devMarkers[data[i]._ID[2]]=_this.deviceL.add("markGreen",[{lon:data[i]._ID[0],lat:data[i]._ID[1],attrs:data[i]._ID[2]}],function(attrs){LG("cb from create marker",attrs)},"hidden")}},initChans:function(){var d=DATA.devChans();var loc;for(var id in d){loc=d[id];chanContours[id]=[];for(var i=0;i<loc.length;i++){var L=getRange(loc[i].Pwr,true);chanContours[id].push(_this[L].add([loc[i].loc],L,function(){}))}}},deviceVis:function(id,vis,active,doCenter){devMarkers[id].display(vis!=0);typeof active!="undefined"&&active&&devMarkers[active].setUrl(devUrl[1]);if(vis){devMarkers[id].setUrl(devUrl[vis]);typeof doCenter!="undefined"&&doCenter&&map.setCenter(devMarkers[id].lonlat)}map.setLayerIndex(_this.deviceL,zIndex++)},chanVis:function(id,loc,vis){for(var i in chanContours[id])chanContours[id][i][0].style.display=chanContours[id][i][1].style.display=vis?"block":"none";toTop(contours,true)},showChan:function(showIt){for(var i in chanContours){for(var j=0;j<chanContours[i].length;j++){chanContours[i][j][0].style.display=chanContours[i][j][1].style.display=showIt?"block":"none"}}toTop(contours,true)},showDev:function(showIt){for(var i=0 in devMarkers)devMarkers[i].display(showIt);toTop("deviceL")},chanToFront:function(){toTop(contours)},devToFront:function(){toTop("deviceL")},range:function(idx,vis){var L=getRange(idx);_this[L].setVisibility(vis);vis&&map.setLayerIndex(_this[L],zIndex++)},locAddress:function(addr,cb){geocoder.geocode({address:addr},function(results,status){if(status==google.maps.GeocoderStatus.OK){var loc=results[0].geometry.location;map.setCenter(lonLat(loc.B,loc.k,true),22);cb({lat:loc.k,lon:loc.B})}else{cb(false)}})}}}]).factory("OLStyle",[function(){var STYLES={};var Host="http://"+document.location.host+"/";var imgPath=Host+"image/";var markerWidth24=16;var markerWidth36=24;var def=function(styleId,base,params){if(typeof STYLES[styleId]=="undefined"){STYLES[styleId]=angular.extend({},OpenLayers.Feature.Vector.style["default"]);if(base)for(var i in STYLES[base])STYLES[styleId][i]=STYLES[base][i];for(var i in params)STYLES[styleId][i]=params[i]}};def("base","",{graphicOpacity:1,strokeWidth:1});def("pin","",{graphicHeight:24,graphicYOffset:-24,graphicWidth:12,graphicXOffset:-6,externalGraphic:imgPath+"pin.png",fillOpacity:1});def("contL","pin",{strokeColor:"#000088",fillColor:"#0044FF",fillOpacity:.2,strokeWidth:.5});def("contM","contL",{strokeColor:"#004400",fillColor:"#00AA22"});def("contS","contL",{strokeColor:"#440000",fillColor:"#FF2200"});def("center","",{graphicHeight:32,graphicYOffset:-32,graphicWidth:32,graphicXOffset:-16,externalGraphic:imgPath+"target.png",fillOpacity:1});def("marker","pin",{externalGraphic:imgPath+"marker.png"});return{get:function(styleId){return angular.extend({},STYLES[styleId])}}}]).factory("OLCtrl",[function(){var _this=this;var cbk=null;var ml=new OpenLayers.Layer.Vector("Selects");var actions={box:function(b){typeof b.bottom=="undefined"||_this.cbk(_this.map.getLonLatFromPixel(new OpenLayers.Pixel(b.left,b.bottom)).transform("EPSG:3857","EPSG:4326"),_this.map.getLonLatFromPixel(new OpenLayers.Pixel(b.right,b.top)).transform("EPSG:3857","EPSG:4326"))},point:function(a){_this.cbk(a)},center:function(a){_this.map.setCenter(new OpenLayers.LonLat(a.x,a.y));var pt=new OpenLayers.LonLat(a.x,a.y);pt.transform("EPSG:3857","EPSG:4326");_this.map.getLayersByName("centerL")[0].add("marker",[{lon:pt.lon,lat:pt.lat,attrs:{id:0}}],function(attrs){console.log(attrs)});setTimeout(function(){_this.map.getLayersByName("centerL")[0].clearMarkers()},500);_this.cbk(pt)},elevation:function(a){_this.cbk(a)}};var ctrls={box:new OpenLayers.Control.DrawFeature(ml,OpenLayers.Handler.Box,{callbacks:{done:actions.box}}),center:new OpenLayers.Control.DrawFeature(ml,OpenLayers.Handler.Point,{callbacks:{done:actions.center}}),point:new OpenLayers.Control.DrawFeature(ml,OpenLayers.Handler.Point,{callbacks:{done:function(a){a.transform("EPSG:3857","EPSG:4326");actions.point(new OpenLayers.LonLat(a.x,a.y),0)}}}),elevation:new OpenLayers.Control.DrawFeature(ml,OpenLayers.Handler.Point,{callbacks:{done:function(a){a.transform("EPSG:3857","EPSG:4326");(new google.maps.ElevationService).getElevationForLocations({locations:[new google.maps.LatLng(a.y,a.x)]},function(v){_this.cbk(new OpenLayers.LonLat(v[0].location.B,v[0].location.k),v[0].elevation)})}}})};setTimeout(function(){_this.map.addLayer(ml)},500);return{map:null,init:function(ctrlName){setTimeout(function(){if(typeof ctrlName=="string")_this.map.addControl(ctrls[ctrlName]);else for(var i=0;i<ctrlName.length;i++)_this.map.addControl(ctrls[ctrlName[i]])},0)},activate:function(ctrlName,cb){_this.cbk=cb;ctrls[ctrlName].activate();ml.setVisibility(true)},deactivate:function(ctrlName){if(ctrlName){ctrls[ctrlName].deactivate();ml.setVisibility(false)}},setMap:function(map){_this.map=map}}}]).factory("OLC",["OLStyle",function(OLStyle){var Point=function(lo,la){return new OpenLayers.Geometry.Point(lo,la).transform("EPSG:4326","EPSG:3857")};var LonLat=function(lo,la){return new OpenLayers.LonLat(lo,la).transform("EPSG:4326","EPSG:3857")};var imgPath="http://"+document.location.host+"/image/";var marker=function(icon,loc,cb,hideIt){typeof loc=="undefined"&&(loc={lon:0,lat:0});var size=new OpenLayers.Size(15,25);var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);var icon=new OpenLayers.Icon(imgPath+icon+".png",size,offset);var m=new OpenLayers.Marker(LonLat(loc.lon,loc.lat),icon);m.attrs=loc.attrs;m.events.register("click",m,cb);m.display(typeof hideIt=="undefined"||!hideIt);return m};var circ=function(origin,radius){typeof radius=="undefined"&&(radius=2e4);return new OpenLayers.Geometry.Polygon.createRegularPolygon(Point(origin[0],origin[1]),radius,30)};var contour=function(l,style,cb,radius,hideIt){typeof l=="string"&&(l=[l]);var ret=[];if(typeof radius=="undefined")radius=style=="contL"?2e4:style=="contM"?1e4:50;for(var i=0;i<l.length;i++){var cStyle=OLStyle.get(style);var mStyle=OLStyle.get("pin");mStyle.display="none";cStyle.display="none";var c=new OpenLayers.Feature.Vector(circ(l[i],radius),null,cStyle);ret.push(c);var m=new OpenLayers.Feature.Vector(Point(l[i][0],l[i][1]),null,mStyle);ret.push(m);m.attrs=c.attrs=l[i][2]}return ret};return{Contour:function(){return false},Contours:function(name,loc,marker){var vect=new OpenLayers.Layer.Vector(name,{rendererOptions:{zIndexing:true}});vect.add=function(a,b,c,d,e){var f;vect.addFeatures(f=contour(a,b,c,d,e));return f};return vect},Marker:function(icon,loc,id){return marker(icon,loc,id)},Markers:function(name){var ret=new OpenLayers.Layer.Markers(name,{rendererOptions:{zIndexing:true}});ret.add=function(icon,coords,cb,hideIt){var m;for(var i=0;i<coords.length;i++)ret.addMarker(m=marker(icon,coords[i],function(e){cb(e.object.attrs)},hideIt));return m};ret.clear=function(){ret.removeMarkers()};ret.show=function(show,id){for(var i=0;i<this.markers.length;i++)if(this.markers[i].id==id||typeof id=="undefined")this.markers[i].display(show)};return ret},Add:function(l,m){l.addMarker(m)}}}]).factory("OLDepr",["OLStyle","OLCtrl",function(OLStyle,OLCtrl){var pointList=function(l,closeIt){var poly=[];for(var i=0;i<l.length;i++)poly.push(new OpenLayers.Geometry.Point(l[i][0],l[i][1]).transform("EPSG:4326","EPSG:3857"));if(typeof closeIt!="undefined"&&closeIt){if(l[0][0]!=l[l.length-1][0]||l[0][1]!=l[l.length-1][1])poly.push(poly[0])}return{o:this,v:poly}};var ring=function(l){var pList=pointList(l,true).v;return new OpenLayers.Geometry.LinearRing(pList)};var circ=function(origin,radius){origin=new OpenLayers.Geometry.Point(origin[0],origin[1]).transform("EPSG:4326","EPSG:3857");typeof radius=="undefined"&&(radius=1300);return new OpenLayers.Geometry.Polygon.createRegularPolygon(origin,radius,40)};var markF=function(l,style){var ret=[];if(typeof l[0]=="number"){var point=new OpenLayers.Geometry.Point(l[i],l[i],OLStyle.get(style)).transform("EPSG:4326","EPSG:3857");ret=new OpenLayers.Feature.Vector(point,null,OLStyle.get(style))}else{for(var i=0;i<l.length;i++){var point=new OpenLayers.Geometry.Point(l[i][0],l[i][1],OLStyle.get(style)).transform("EPSG:4326","EPSG:3857");var vector=new OpenLayers.Feature.Vector(point,null,OLStyle.get(style));ret.push(vector)}}return ret};var ringF=function(l,style){var ret=[];if(typeof l[0]=="number"){ret=new OpenLayers.Feature.Vector(circ(l),null,OLStyle.get(style))}else{for(var i=0;i<l.length;i++){var point=new OpenLayers.Geometry.Point(l[i][0],l[i][1]).transform("EPSG:4326","EPSG:3857");var vector=new OpenLayers.Feature.Vector(point,null,OLStyle.get("marker"));ret.push(new OpenLayers.Feature.Vector(circ(l[i]),null,OLStyle.get(style)));ret.push(vector)}}return ret};var ringV=function(id,l,style){var v=new OpenLayers.Layer.Vector(id,{rendererOptions:{zIndexing:true}});v.addFeatures(ringF(l,style));return v};var ringM=function(id,l,style){var v=new OpenLayers.Layer.Vector(id,{rendererOptions:{zIndexing:true}});v.addFeatures(markF(l,style));return v};var _this=this;return{List:function(l,closeIt){return pointList(l,closeIt)},Ring:function(l){return ring(l)},RingF:function(l,style){return ringF(l,style)},RingV:function(id,l,style){return ringV(id,l,style)},RingM:function(id,l,style){return ringM(id,l,style)},setMap:function(map){OLCtrl.setMap(_this.map=map)},initCtrls:function(what){OLCtrl.init(what)},showFeatures:function(layer,doShow){doShow=typeof doShow=="undefined"||!doShow;var layer=_this.map.getLayersByName(layer)[0];for(var i=0;i<layer.features.length;i++)layer.features[i].style.display=doShow?"block":"none";layer.redraw()},activate:function(ctrlName,cb){OLCtrl.activate(ctrlName,function(a,b){cb(a,b)})},deactivate:function(ctrlName){OLCtrl.deactivate(ctrlName)}}}]).factory("UT",[function(){return{plunk:function(inA,idx){var retA=[];for(var i=0;i<inA.length;i++){if(i!=idx)retA.push(inA[i])}return retA},plunkVal:function(inA,val){var retA=[];for(var i=0;i<inA.length;i++){if(inA[i]!=val)retA.push(inA[i])}return retA},inRange:function(vals,key,range){for(var i=0;i<vals.length;i++)if(vals[i][key]<range[0]||vals[i][key]>range[1])return false;return true},arEmpty:function(ar){for(var i=0;i<ar.length;i++)if(ar[i])return false;return true},camelize:function(str){return(str+"").replace(/-\D/g,function(match){return match.charAt(1).toUpperCase()})}}}]);